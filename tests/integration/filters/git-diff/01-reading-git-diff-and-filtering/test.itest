RUN: mkdir -p sandbox
RUN: cd sandbox
RUN: cp ../sample.cpp.original sample.cpp
RUN: git init . -b main
RUN: git add sample.cpp
RUN: git -c user.name='Mull' -c user.email=alex@lowlevelbits.org commit -m "Impersonation is evil."
RUN: cp ../sample.cpp.modified sample.cpp
RUN: cd ..
RUN: env MULL_CONFIG=mull-ir-frontend.yml %clang_cxx %sysroot -O0 %pass_mull_ir_frontend -g sandbox/sample.cpp -o sample.cpp-ir.exe | %filecheck %s --dump-input=fail --strict-whitespace --match-full-lines  --check-prefix=CHECK_FRONTEND
RUN: (unset TERM; %mull_runner sample.cpp-ir.exe -ide-reporter-show-killed 2>&1; test $? = 0) | %filecheck %s --dump-input=fail --strict-whitespace --match-full-lines

CHECK_FRONTEND:[info] Incremental testing using Git Diff is enabled.
CHECK_FRONTEND:- Git ref: main
CHECK_FRONTEND:- Git project root: {{.*}}/sandbox

CHECK_FRONTEND:[debug] GitDiffFilter: allowing instruction: {{.*}}/sample.cpp:4:7
CHECK_FRONTEND:[debug] GitDiffFilter: allowing instruction: {{.*}}/sample.cpp:4:11
CHECK_FRONTEND:[debug] GitDiffFilter: skipping instruction: {{.*}}/sample.cpp:7:7
CHECK_FRONTEND:[debug] GitDiffFilter: skipping instruction: {{.*}}/sample.cpp:7:11

CHECK:[info] Killed mutants (2/2):
CHECK:{{^.*}}sample.cpp:4:11: warning: Killed: Replaced >= with > [cxx_ge_to_gt]{{$}}
CHECK:{{^.*}}sample.cpp:4:11: warning: Killed: Replaced >= with < [cxx_ge_to_lt]{{$}}
CHECK:[info] All mutations have been killed
CHECK:[info] Mutation score: 100%

RUN: %clang_cxx %sysroot -O0 %pass_mull_ir_frontend -g sandbox/sample.cpp -o sample.cpp-ir.exe
RUN: (unset TERM; env MULL_CONFIG=mull-runner.yml %mull_runner sample.cpp-ir.exe -ide-reporter-show-killed 2>&1; test $? = 0) | %filecheck %s --dump-input=fail --strict-whitespace --match-full-lines --check-prefix=CHECK_RUNNER

CHECK_RUNNER:[info] Incremental testing using Git Diff is enabled.
CHECK_RUNNER:- Git ref: main
CHECK_RUNNER:- Git project root: {{.*}}/sandbox
CHECK_RUNNER:[debug] GitDiffFilter: allowing mutant: {{.*}}/sample.cpp:4:11
CHECK_RUNNER:[debug] GitDiffFilter: skipping mutant: {{.*}}/sample.cpp:7:11
CHECK_RUNNER:[info] Killed mutants (2/2):
CHECK_RUNNER:{{^.*}}sample.cpp:4:11: warning: Killed: Replaced >= with > [cxx_ge_to_gt]{{$}}
CHECK_RUNNER:{{^.*}}sample.cpp:4:11: warning: Killed: Replaced >= with < [cxx_ge_to_lt]{{$}}
CHECK_RUNNER:[info] All mutations have been killed
CHECK_RUNNER:[info] Mutation score: 100%
